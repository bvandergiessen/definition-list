'use strict';

var obsidian = require('obsidian');
var view = require('@codemirror/view');

/******************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise, SuppressedError, Symbol, Iterator */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    if (typeof b !== "function" && b !== null)
        throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
    var e = new Error(message);
    return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};

var DefinitionListPlugin = /** @class */ (function (_super) {
    __extends(DefinitionListPlugin, _super);
    function DefinitionListPlugin() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.formatDefinitionLists = function (element, context) {
            /* The post-processor is called
             *  - when switching to Reading view: once per div that has changed
             *  - when exporting to PDF: on the whole page div
             *  - when the document first enters Reading view: on every child-div of page div
             */
            /* In direct descendants of type paragraph, look for definition lists.
             * Return as soon as possible.  */
            var paragraphs = element.findAll(':scope > p, :scope > div > p');
            var nothingToDo = true;
            for (var _i = 0, paragraphs_1 = paragraphs; _i < paragraphs_1.length; _i++) {
                var par = paragraphs_1[_i];
                if (par.innerHTML.includes('<br>\n:   ')) {
                    nothingToDo = false;
                    break;
                }
            }
            if (nothingToDo)
                return;
            return new Promise(function (resultCallback, errorCallback) {
                // TODO: some error checking
                paragraphs.forEach(function (par) {
                    if (!par.innerHTML.includes('<br>\n:   '))
                        return;
                    // create the <dl> element that is to replace the paragraph element
                    var defList = document.createElement('dl');
                    var startOfLine = true;
                    var itemElement;
                    // fill the new <dl> with clones of the nodes in the original <p>
                    par.childNodes.forEach(function (node) {
                        if ('tagName' in node && node.tagName === "BR") {
                            startOfLine = true;
                            return;
                        }
                        var clone = node.cloneNode(true);
                        if (startOfLine) {
                            var matchDef = node.textContent.match(DefinitionListPlugin.definitionMarker);
                            if (matchDef) {
                                itemElement = defList.createEl('dd');
                                clone.textContent = node.textContent.slice(matchDef[0].length);
                            }
                            else {
                                itemElement = defList.createEl('dt');
                            }
                            startOfLine = false;
                        }
                        itemElement.append(clone);
                    });
                    // put the <dl> in place of the <p>
                    par.replaceWith(defList);
                });
                resultCallback(null);
            });
        };
        return _this;
    }
    DefinitionListPlugin.prototype.onInit = function () { };
    DefinitionListPlugin.prototype.onload = function () {
        console.log("Loading plugin Definition List v".concat(this.manifest.version));
        this.registerMarkdownPostProcessor(this.formatDefinitionLists, 99);
        this.addSettingTab(new DefinitionListSettingTab(this.app, this));
        this.registerEditorExtension(liveUpdateDefinitionLists);
    };
    DefinitionListPlugin.prototype.onunload = function () {
        console.log('Unloading plugin Definition List');
    };
    DefinitionListPlugin.definitionMarker = /^\n?:   /;
    return DefinitionListPlugin;
}(obsidian.Plugin));
/* The ViewPlugin class is generic: it requires an underlying type, a subclass of
* the PluginValue class. That is to be the first argument passed into the class method
* .fromClass() which returns a ViewPlugin instance with that underlying type.
* The second argument of that class method, to give additional details, is a PluginSpec
* instance with the same underlying type. It has zero or more of the properties eventHandlers,
* eventObservers, provide, and decorations. The latter is a function that, when passed an
* instance of the underlying class, returns a DecorationSet - in this case the function
* simply returns the .decorations instance property. */
var liveUpdateDefinitionLists = view.ViewPlugin.fromClass(/** @class */ (function () {
    function class_1(view$1) {
        this.TERM_CLASS = 'view-dt';
        this.DEF_CLASS = 'view-dd';
        this.decorations = view.Decoration.none;
    }
    /* this.decorations should be a cumulative array of all the decorations (i.e.
    * class changes) we have chosen to add to line elements. So we always add to it
    * or modify an existing entry, rather than instantiating it anew.
    * Note that its type, DecorationSet, is a RangeSet of items of the underlying
    * type Decoration. Such a RangeSet object has properties and methods
    * .size (number of elements); .iter() with optional arg from, an offset that
    * lies in or before the first to be iterated; .update(RangeSetUpdate) to add
    * or remove them (returns the new version); .between(from, to, func) run func
    * on every Decoration between the offsets from and to; .map(ChangeDesc). */
    class_1.prototype.update = function (update) {
        var _a;
        if (update.docChanged || update.selectionSet) 
        /* other boolean properties that may be useful:
        *  .viewportChanged: viewport or visible ranges have changed
        *  .geometryChanged: editor size or the document itself changed
        *  .focusChanged: maybe some switch to another document, panel etc.;
        *  change in View between Editing and Rendering view; but
        *  when the document/Editing is activated, .geometryChanged is also true.
        */
        {
            var state = update.view.state;
            var cursorPos = state.selection.main.head;
            // the Line object that represents the current line of the document
            // note that state.doc is an object of class Text
            var currentLine = state.doc.lineAt(cursorPos);
            // the text of the following line
            var nextLineText = (state.doc.lines === currentLine.number) ? '' :
                state.doc.line(currentLine.number + 1).text;
            if (!currentLine.text.startsWith(':   ') && !nextLineText.startsWith(':   '))
                return;
            // TODO: two terms before one definition
            // TODO: put : and first spaces in a separate div or so
            //  and then in CSS say div:not(.cm-active)>.leading-chars {display: none;}
            // TODO: parse all definition lists when first opening Edit View, or at
            //  least those inside the viewport
            // TODO: implement removal of class when it's not a DL anymore after an edit
            // Perform a few checks before adding any classes
            var lineClasses = ((_a = update.view.domAtPos(cursorPos).node.parentElement.closest('.cm-line')) === null || _a === void 0 ? void 0 : _a.classList) ||
                { contains: function (s) { return false; } };
            // No definition lists inside a code block
            if (lineClasses.contains('HyperMD-codeblock'))
                return;
            // Don't add a class when it's already been done
            if (lineClasses.contains(this.DEF_CLASS) ||
                lineClasses.contains(this.TERM_CLASS))
                return;
            // Finally, as all criteria have been met, we get to work
            var lineclass = (currentLine.text.startsWith(':   ')) ? this.DEF_CLASS : this.TERM_CLASS;
            this.decorations = this.decorations.update({ add: [view.Decoration
                        .line({ class: lineclass })
                        .range(currentLine.from)] }); // line decorations are 0-length
            /* the argument for .update is of class RangeSetUpdate<Decoration>,
            * and RangeSetUpdate is a typedef of an Object with optional
            * property .add of class readonly Range<Decoration>; that in turn has
            * instance properties from, to, and the Decoration.
            * You can create a Range<Decoration> by creating a Decoration and
            * applying its .range method (inherited from its superclass RangeValue).
            * Note that .update doesn't modify the instance but returns it. */
        }
        // if (update.viewportChanged) console.log('viewport changed');
        // if (update.geometryChanged) console.log('geometry changed');
    };
    return class_1;
}()), {
    decorations: function (v) { return v.decorations; },
});
var DefinitionListSettingTab = /** @class */ (function (_super) {
    __extends(DefinitionListSettingTab, _super);
    function DefinitionListSettingTab() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DefinitionListSettingTab.prototype.display = function () {
        var containerEl = this.containerEl;
        containerEl.empty();
        containerEl.createEl('h2', { text: 'Settings for my awesome plugin.' });
        new obsidian.Setting(containerEl)
            .setName('Setting #1')
            .setDesc('It\'s a secret')
            .addText(function (text) { return text.setPlaceholder('Enter your secret')
            .setValue('')
            .onChange(function (value) {
            console.log('Secret: ' + value);
        }); });
    };
    return DefinitionListSettingTab;
}(obsidian.PluginSettingTab));

module.exports = DefinitionListPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsIm1haW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlLCBTdXBwcmVzc2VkRXJyb3IsIFN5bWJvbCwgSXRlcmF0b3IgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fYXNzaWduID0gZnVuY3Rpb24oKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH1cclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZXN0KHMsIGUpIHtcclxuICAgIHZhciB0ID0ge307XHJcbiAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcclxuICAgICAgICB0W3BdID0gc1twXTtcclxuICAgIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgcCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMocyk7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSlcclxuICAgICAgICAgICAgICAgIHRbcFtpXV0gPSBzW3BbaV1dO1xyXG4gICAgICAgIH1cclxuICAgIHJldHVybiB0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcGFyYW0ocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXNEZWNvcmF0ZShjdG9yLCBkZXNjcmlwdG9ySW4sIGRlY29yYXRvcnMsIGNvbnRleHRJbiwgaW5pdGlhbGl6ZXJzLCBleHRyYUluaXRpYWxpemVycykge1xyXG4gICAgZnVuY3Rpb24gYWNjZXB0KGYpIHsgaWYgKGYgIT09IHZvaWQgMCAmJiB0eXBlb2YgZiAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRnVuY3Rpb24gZXhwZWN0ZWRcIik7IHJldHVybiBmOyB9XHJcbiAgICB2YXIga2luZCA9IGNvbnRleHRJbi5raW5kLCBrZXkgPSBraW5kID09PSBcImdldHRlclwiID8gXCJnZXRcIiA6IGtpbmQgPT09IFwic2V0dGVyXCIgPyBcInNldFwiIDogXCJ2YWx1ZVwiO1xyXG4gICAgdmFyIHRhcmdldCA9ICFkZXNjcmlwdG9ySW4gJiYgY3RvciA/IGNvbnRleHRJbltcInN0YXRpY1wiXSA/IGN0b3IgOiBjdG9yLnByb3RvdHlwZSA6IG51bGw7XHJcbiAgICB2YXIgZGVzY3JpcHRvciA9IGRlc2NyaXB0b3JJbiB8fCAodGFyZ2V0ID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGNvbnRleHRJbi5uYW1lKSA6IHt9KTtcclxuICAgIHZhciBfLCBkb25lID0gZmFsc2U7XHJcbiAgICBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgIHZhciBjb250ZXh0ID0ge307XHJcbiAgICAgICAgZm9yICh2YXIgcCBpbiBjb250ZXh0SW4pIGNvbnRleHRbcF0gPSBwID09PSBcImFjY2Vzc1wiID8ge30gOiBjb250ZXh0SW5bcF07XHJcbiAgICAgICAgZm9yICh2YXIgcCBpbiBjb250ZXh0SW4uYWNjZXNzKSBjb250ZXh0LmFjY2Vzc1twXSA9IGNvbnRleHRJbi5hY2Nlc3NbcF07XHJcbiAgICAgICAgY29udGV4dC5hZGRJbml0aWFsaXplciA9IGZ1bmN0aW9uIChmKSB7IGlmIChkb25lKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGFkZCBpbml0aWFsaXplcnMgYWZ0ZXIgZGVjb3JhdGlvbiBoYXMgY29tcGxldGVkXCIpOyBleHRyYUluaXRpYWxpemVycy5wdXNoKGFjY2VwdChmIHx8IG51bGwpKTsgfTtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gKDAsIGRlY29yYXRvcnNbaV0pKGtpbmQgPT09IFwiYWNjZXNzb3JcIiA/IHsgZ2V0OiBkZXNjcmlwdG9yLmdldCwgc2V0OiBkZXNjcmlwdG9yLnNldCB9IDogZGVzY3JpcHRvcltrZXldLCBjb250ZXh0KTtcclxuICAgICAgICBpZiAoa2luZCA9PT0gXCJhY2Nlc3NvclwiKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgY29udGludWU7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IG51bGwgfHwgdHlwZW9mIHJlc3VsdCAhPT0gXCJvYmplY3RcIikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIk9iamVjdCBleHBlY3RlZFwiKTtcclxuICAgICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LmdldCkpIGRlc2NyaXB0b3IuZ2V0ID0gXztcclxuICAgICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LnNldCkpIGRlc2NyaXB0b3Iuc2V0ID0gXztcclxuICAgICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LmluaXQpKSBpbml0aWFsaXplcnMudW5zaGlmdChfKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoXyA9IGFjY2VwdChyZXN1bHQpKSB7XHJcbiAgICAgICAgICAgIGlmIChraW5kID09PSBcImZpZWxkXCIpIGluaXRpYWxpemVycy51bnNoaWZ0KF8pO1xyXG4gICAgICAgICAgICBlbHNlIGRlc2NyaXB0b3Jba2V5XSA9IF87XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRhcmdldCkgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgY29udGV4dEluLm5hbWUsIGRlc2NyaXB0b3IpO1xyXG4gICAgZG9uZSA9IHRydWU7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19ydW5Jbml0aWFsaXplcnModGhpc0FyZywgaW5pdGlhbGl6ZXJzLCB2YWx1ZSkge1xyXG4gICAgdmFyIHVzZVZhbHVlID0gYXJndW1lbnRzLmxlbmd0aCA+IDI7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluaXRpYWxpemVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHZhbHVlID0gdXNlVmFsdWUgPyBpbml0aWFsaXplcnNbaV0uY2FsbCh0aGlzQXJnLCB2YWx1ZSkgOiBpbml0aWFsaXplcnNbaV0uY2FsbCh0aGlzQXJnKTtcclxuICAgIH1cclxuICAgIHJldHVybiB1c2VWYWx1ZSA/IHZhbHVlIDogdm9pZCAwO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcHJvcEtleSh4KSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHggPT09IFwic3ltYm9sXCIgPyB4IDogXCJcIi5jb25jYXQoeCk7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zZXRGdW5jdGlvbk5hbWUoZiwgbmFtZSwgcHJlZml4KSB7XHJcbiAgICBpZiAodHlwZW9mIG5hbWUgPT09IFwic3ltYm9sXCIpIG5hbWUgPSBuYW1lLmRlc2NyaXB0aW9uID8gXCJbXCIuY29uY2F0KG5hbWUuZGVzY3JpcHRpb24sIFwiXVwiKSA6IFwiXCI7XHJcbiAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGYsIFwibmFtZVwiLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgdmFsdWU6IHByZWZpeCA/IFwiXCIuY29uY2F0KHByZWZpeCwgXCIgXCIsIG5hbWUpIDogbmFtZSB9KTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX21ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZ2VuZXJhdG9yKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGcgPSBPYmplY3QuY3JlYXRlKCh0eXBlb2YgSXRlcmF0b3IgPT09IFwiZnVuY3Rpb25cIiA/IEl0ZXJhdG9yIDogT2JqZWN0KS5wcm90b3R5cGUpO1xyXG4gICAgcmV0dXJuIGcubmV4dCA9IHZlcmIoMCksIGdbXCJ0aHJvd1wiXSA9IHZlcmIoMSksIGdbXCJyZXR1cm5cIl0gPSB2ZXJiKDIpLCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKGcgJiYgKGcgPSAwLCBvcFswXSAmJiAoXyA9IDApKSwgXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxyXG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fY3JlYXRlQmluZGluZyA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcclxuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XHJcbiAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobSwgayk7XHJcbiAgICBpZiAoIWRlc2MgfHwgKFwiZ2V0XCIgaW4gZGVzYyA/ICFtLl9fZXNNb2R1bGUgOiBkZXNjLndyaXRhYmxlIHx8IGRlc2MuY29uZmlndXJhYmxlKSkge1xyXG4gICAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH07XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIGRlc2MpO1xyXG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIG9bazJdID0gbVtrXTtcclxufSk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKHAgIT09IFwiZGVmYXVsdFwiICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgcCkpIF9fY3JlYXRlQmluZGluZyhvLCBtLCBwKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcclxuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZWFkKG8sIG4pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcclxuICAgIGlmICghbSkgcmV0dXJuIG87XHJcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgd2hpbGUgKChuID09PSB2b2lkIDAgfHwgbi0tID4gMCkgJiYgIShyID0gaS5uZXh0KCkpLmRvbmUpIGFyLnB1c2goci52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cclxuICAgIGZpbmFsbHkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcclxuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxyXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxyXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcclxuICAgIHJldHVybiByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheSh0bywgZnJvbSwgcGFjaykge1xyXG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XHJcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XHJcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IE9iamVjdC5jcmVhdGUoKHR5cGVvZiBBc3luY0l0ZXJhdG9yID09PSBcImZ1bmN0aW9uXCIgPyBBc3luY0l0ZXJhdG9yIDogT2JqZWN0KS5wcm90b3R5cGUpLCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIsIGF3YWl0UmV0dXJuKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gYXdhaXRSZXR1cm4oZikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2KS50aGVuKGYsIHJlamVjdCk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHZlcmIobiwgZikgeyBpZiAoZ1tuXSkgeyBpW25dID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhLCBiKSB7IHEucHVzaChbbiwgdiwgYSwgYl0pID4gMSB8fCByZXN1bWUobiwgdik7IH0pOyB9OyBpZiAoZikgaVtuXSA9IGYoaVtuXSk7IH0gfVxyXG4gICAgZnVuY3Rpb24gcmVzdW1lKG4sIHYpIHsgdHJ5IHsgc3RlcChnW25dKHYpKTsgfSBjYXRjaCAoZSkgeyBzZXR0bGUocVswXVszXSwgZSk7IH0gfVxyXG4gICAgZnVuY3Rpb24gc3RlcChyKSB7IHIudmFsdWUgaW5zdGFuY2VvZiBfX2F3YWl0ID8gUHJvbWlzZS5yZXNvbHZlKHIudmFsdWUudikudGhlbihmdWxmaWxsLCByZWplY3QpIDogc2V0dGxlKHFbMF1bMl0sIHIpOyB9XHJcbiAgICBmdW5jdGlvbiBmdWxmaWxsKHZhbHVlKSB7IHJlc3VtZShcIm5leHRcIiwgdmFsdWUpOyB9XHJcbiAgICBmdW5jdGlvbiByZWplY3QodmFsdWUpIHsgcmVzdW1lKFwidGhyb3dcIiwgdmFsdWUpOyB9XHJcbiAgICBmdW5jdGlvbiBzZXR0bGUoZiwgdikgeyBpZiAoZih2KSwgcS5zaGlmdCgpLCBxLmxlbmd0aCkgcmVzdW1lKHFbMF1bMF0sIHFbMF1bMV0pOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jRGVsZWdhdG9yKG8pIHtcclxuICAgIHZhciBpLCBwO1xyXG4gICAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiLCBmdW5jdGlvbiAoZSkgeyB0aHJvdyBlOyB9KSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobiwgZikgeyBpW25dID0gb1tuXSA/IGZ1bmN0aW9uICh2KSB7IHJldHVybiAocCA9ICFwKSA/IHsgdmFsdWU6IF9fYXdhaXQob1tuXSh2KSksIGRvbmU6IGZhbHNlIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xyXG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcclxufTtcclxuXHJcbnZhciBvd25LZXlzID0gZnVuY3Rpb24obykge1xyXG4gICAgb3duS2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHx8IGZ1bmN0aW9uIChvKSB7XHJcbiAgICAgICAgdmFyIGFyID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgayBpbiBvKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG8sIGspKSBhclthci5sZW5ndGhdID0gaztcclxuICAgICAgICByZXR1cm4gYXI7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIG93bktleXMobyk7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnRTdGFyKG1vZCkge1xyXG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcclxuICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayA9IG93bktleXMobW9kKSwgaSA9IDA7IGkgPCBrLmxlbmd0aDsgaSsrKSBpZiAoa1tpXSAhPT0gXCJkZWZhdWx0XCIpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwga1tpXSk7XHJcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0RGVmYXVsdChtb2QpIHtcclxuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgZGVmYXVsdDogbW9kIH07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHJlY2VpdmVyLCBzdGF0ZSwga2luZCwgZikge1xyXG4gICAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgZ2V0dGVyXCIpO1xyXG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgcmVhZCBwcml2YXRlIG1lbWJlciBmcm9tIGFuIG9iamVjdCB3aG9zZSBjbGFzcyBkaWQgbm90IGRlY2xhcmUgaXRcIik7XHJcbiAgICByZXR1cm4ga2luZCA9PT0gXCJtXCIgPyBmIDoga2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIpIDogZiA/IGYudmFsdWUgOiBzdGF0ZS5nZXQocmVjZWl2ZXIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZFNldChyZWNlaXZlciwgc3RhdGUsIHZhbHVlLCBraW5kLCBmKSB7XHJcbiAgICBpZiAoa2luZCA9PT0gXCJtXCIpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIG1ldGhvZCBpcyBub3Qgd3JpdGFibGVcIik7XHJcbiAgICBpZiAoa2luZCA9PT0gXCJhXCIgJiYgIWYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIGFjY2Vzc29yIHdhcyBkZWZpbmVkIHdpdGhvdXQgYSBzZXR0ZXJcIik7XHJcbiAgICBpZiAodHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciAhPT0gc3RhdGUgfHwgIWYgOiAhc3RhdGUuaGFzKHJlY2VpdmVyKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCB3cml0ZSBwcml2YXRlIG1lbWJlciB0byBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xyXG4gICAgcmV0dXJuIChraW5kID09PSBcImFcIiA/IGYuY2FsbChyZWNlaXZlciwgdmFsdWUpIDogZiA/IGYudmFsdWUgPSB2YWx1ZSA6IHN0YXRlLnNldChyZWNlaXZlciwgdmFsdWUpKSwgdmFsdWU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkSW4oc3RhdGUsIHJlY2VpdmVyKSB7XHJcbiAgICBpZiAocmVjZWl2ZXIgPT09IG51bGwgfHwgKHR5cGVvZiByZWNlaXZlciAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgcmVjZWl2ZXIgIT09IFwiZnVuY3Rpb25cIikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgdXNlICdpbicgb3BlcmF0b3Igb24gbm9uLW9iamVjdFwiKTtcclxuICAgIHJldHVybiB0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyID09PSBzdGF0ZSA6IHN0YXRlLmhhcyhyZWNlaXZlcik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FkZERpc3Bvc2FibGVSZXNvdXJjZShlbnYsIHZhbHVlLCBhc3luYykge1xyXG4gICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB2b2lkIDApIHtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiT2JqZWN0IGV4cGVjdGVkLlwiKTtcclxuICAgICAgICB2YXIgZGlzcG9zZSwgaW5uZXI7XHJcbiAgICAgICAgaWYgKGFzeW5jKSB7XHJcbiAgICAgICAgICAgIGlmICghU3ltYm9sLmFzeW5jRGlzcG9zZSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0Rpc3Bvc2UgaXMgbm90IGRlZmluZWQuXCIpO1xyXG4gICAgICAgICAgICBkaXNwb3NlID0gdmFsdWVbU3ltYm9sLmFzeW5jRGlzcG9zZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkaXNwb3NlID09PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgaWYgKCFTeW1ib2wuZGlzcG9zZSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5kaXNwb3NlIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgICAgICAgICAgZGlzcG9zZSA9IHZhbHVlW1N5bWJvbC5kaXNwb3NlXTtcclxuICAgICAgICAgICAgaWYgKGFzeW5jKSBpbm5lciA9IGRpc3Bvc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgZGlzcG9zZSAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiT2JqZWN0IG5vdCBkaXNwb3NhYmxlLlwiKTtcclxuICAgICAgICBpZiAoaW5uZXIpIGRpc3Bvc2UgPSBmdW5jdGlvbigpIHsgdHJ5IHsgaW5uZXIuY2FsbCh0aGlzKTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gUHJvbWlzZS5yZWplY3QoZSk7IH0gfTtcclxuICAgICAgICBlbnYuc3RhY2sucHVzaCh7IHZhbHVlOiB2YWx1ZSwgZGlzcG9zZTogZGlzcG9zZSwgYXN5bmM6IGFzeW5jIH0pO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoYXN5bmMpIHtcclxuICAgICAgICBlbnYuc3RhY2sucHVzaCh7IGFzeW5jOiB0cnVlIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG5cclxufVxyXG5cclxudmFyIF9TdXBwcmVzc2VkRXJyb3IgPSB0eXBlb2YgU3VwcHJlc3NlZEVycm9yID09PSBcImZ1bmN0aW9uXCIgPyBTdXBwcmVzc2VkRXJyb3IgOiBmdW5jdGlvbiAoZXJyb3IsIHN1cHByZXNzZWQsIG1lc3NhZ2UpIHtcclxuICAgIHZhciBlID0gbmV3IEVycm9yKG1lc3NhZ2UpO1xyXG4gICAgcmV0dXJuIGUubmFtZSA9IFwiU3VwcHJlc3NlZEVycm9yXCIsIGUuZXJyb3IgPSBlcnJvciwgZS5zdXBwcmVzc2VkID0gc3VwcHJlc3NlZCwgZTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2Rpc3Bvc2VSZXNvdXJjZXMoZW52KSB7XHJcbiAgICBmdW5jdGlvbiBmYWlsKGUpIHtcclxuICAgICAgICBlbnYuZXJyb3IgPSBlbnYuaGFzRXJyb3IgPyBuZXcgX1N1cHByZXNzZWRFcnJvcihlLCBlbnYuZXJyb3IsIFwiQW4gZXJyb3Igd2FzIHN1cHByZXNzZWQgZHVyaW5nIGRpc3Bvc2FsLlwiKSA6IGU7XHJcbiAgICAgICAgZW52Lmhhc0Vycm9yID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHZhciByLCBzID0gMDtcclxuICAgIGZ1bmN0aW9uIG5leHQoKSB7XHJcbiAgICAgICAgd2hpbGUgKHIgPSBlbnYuc3RhY2sucG9wKCkpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGlmICghci5hc3luYyAmJiBzID09PSAxKSByZXR1cm4gcyA9IDAsIGVudi5zdGFjay5wdXNoKHIpLCBQcm9taXNlLnJlc29sdmUoKS50aGVuKG5leHQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHIuZGlzcG9zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSByLmRpc3Bvc2UuY2FsbChyLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoci5hc3luYykgcmV0dXJuIHMgfD0gMiwgUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCkudGhlbihuZXh0LCBmdW5jdGlvbihlKSB7IGZhaWwoZSk7IHJldHVybiBuZXh0KCk7IH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBzIHw9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIGZhaWwoZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHMgPT09IDEpIHJldHVybiBlbnYuaGFzRXJyb3IgPyBQcm9taXNlLnJlamVjdChlbnYuZXJyb3IpIDogUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgICAgaWYgKGVudi5oYXNFcnJvcikgdGhyb3cgZW52LmVycm9yO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5leHQoKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmV3cml0ZVJlbGF0aXZlSW1wb3J0RXh0ZW5zaW9uKHBhdGgsIHByZXNlcnZlSnN4KSB7XHJcbiAgICBpZiAodHlwZW9mIHBhdGggPT09IFwic3RyaW5nXCIgJiYgL15cXC5cXC4/XFwvLy50ZXN0KHBhdGgpKSB7XHJcbiAgICAgICAgcmV0dXJuIHBhdGgucmVwbGFjZSgvXFwuKHRzeCkkfCgoPzpcXC5kKT8pKCg/OlxcLlteLi9dKz8pPylcXC4oW2NtXT8pdHMkL2ksIGZ1bmN0aW9uIChtLCB0c3gsIGQsIGV4dCwgY20pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRzeCA/IHByZXNlcnZlSnN4ID8gXCIuanN4XCIgOiBcIi5qc1wiIDogZCAmJiAoIWV4dCB8fCAhY20pID8gbSA6IChkICsgZXh0ICsgXCIuXCIgKyBjbS50b0xvd2VyQ2FzZSgpICsgXCJqc1wiKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBwYXRoO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgICBfX2V4dGVuZHM6IF9fZXh0ZW5kcyxcclxuICAgIF9fYXNzaWduOiBfX2Fzc2lnbixcclxuICAgIF9fcmVzdDogX19yZXN0LFxyXG4gICAgX19kZWNvcmF0ZTogX19kZWNvcmF0ZSxcclxuICAgIF9fcGFyYW06IF9fcGFyYW0sXHJcbiAgICBfX2VzRGVjb3JhdGU6IF9fZXNEZWNvcmF0ZSxcclxuICAgIF9fcnVuSW5pdGlhbGl6ZXJzOiBfX3J1bkluaXRpYWxpemVycyxcclxuICAgIF9fcHJvcEtleTogX19wcm9wS2V5LFxyXG4gICAgX19zZXRGdW5jdGlvbk5hbWU6IF9fc2V0RnVuY3Rpb25OYW1lLFxyXG4gICAgX19tZXRhZGF0YTogX19tZXRhZGF0YSxcclxuICAgIF9fYXdhaXRlcjogX19hd2FpdGVyLFxyXG4gICAgX19nZW5lcmF0b3I6IF9fZ2VuZXJhdG9yLFxyXG4gICAgX19jcmVhdGVCaW5kaW5nOiBfX2NyZWF0ZUJpbmRpbmcsXHJcbiAgICBfX2V4cG9ydFN0YXI6IF9fZXhwb3J0U3RhcixcclxuICAgIF9fdmFsdWVzOiBfX3ZhbHVlcyxcclxuICAgIF9fcmVhZDogX19yZWFkLFxyXG4gICAgX19zcHJlYWQ6IF9fc3ByZWFkLFxyXG4gICAgX19zcHJlYWRBcnJheXM6IF9fc3ByZWFkQXJyYXlzLFxyXG4gICAgX19zcHJlYWRBcnJheTogX19zcHJlYWRBcnJheSxcclxuICAgIF9fYXdhaXQ6IF9fYXdhaXQsXHJcbiAgICBfX2FzeW5jR2VuZXJhdG9yOiBfX2FzeW5jR2VuZXJhdG9yLFxyXG4gICAgX19hc3luY0RlbGVnYXRvcjogX19hc3luY0RlbGVnYXRvcixcclxuICAgIF9fYXN5bmNWYWx1ZXM6IF9fYXN5bmNWYWx1ZXMsXHJcbiAgICBfX21ha2VUZW1wbGF0ZU9iamVjdDogX19tYWtlVGVtcGxhdGVPYmplY3QsXHJcbiAgICBfX2ltcG9ydFN0YXI6IF9faW1wb3J0U3RhcixcclxuICAgIF9faW1wb3J0RGVmYXVsdDogX19pbXBvcnREZWZhdWx0LFxyXG4gICAgX19jbGFzc1ByaXZhdGVGaWVsZEdldDogX19jbGFzc1ByaXZhdGVGaWVsZEdldCxcclxuICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQ6IF9fY2xhc3NQcml2YXRlRmllbGRTZXQsXHJcbiAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkSW46IF9fY2xhc3NQcml2YXRlRmllbGRJbixcclxuICAgIF9fYWRkRGlzcG9zYWJsZVJlc291cmNlOiBfX2FkZERpc3Bvc2FibGVSZXNvdXJjZSxcclxuICAgIF9fZGlzcG9zZVJlc291cmNlczogX19kaXNwb3NlUmVzb3VyY2VzLFxyXG4gICAgX19yZXdyaXRlUmVsYXRpdmVJbXBvcnRFeHRlbnNpb246IF9fcmV3cml0ZVJlbGF0aXZlSW1wb3J0RXh0ZW5zaW9uLFxyXG59O1xyXG4iLCJpbXBvcnQge1xyXG5cdEFwcCxcclxuXHRQbHVnaW4sXHJcblx0TWFya2Rvd25Qb3N0UHJvY2Vzc29yLFxyXG5cdE1hcmtkb3duU2VjdGlvbkluZm9ybWF0aW9uLFxyXG5cdFBsdWdpblNldHRpbmdUYWIsXHJcblx0U2V0dGluZyxcclxuXHRNYXJrZG93blZpZXdcclxufSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCB7Vmlld1BsdWdpbiwgVmlld1VwZGF0ZSwgRWRpdG9yVmlldywgRGVjb3JhdGlvblNldCwgRGVjb3JhdGlvbn0gZnJvbSAnQGNvZGVtaXJyb3Ivdmlldyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEZWZpbml0aW9uTGlzdFBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcblx0cHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgZGVmaW5pdGlvbk1hcmtlcjogUmVnRXhwID0gL15cXG4/OiAgIC87XHJcblx0XHJcblx0b25Jbml0KCkge31cclxuXHJcblx0b25sb2FkKCkge1xyXG5cdFx0Y29uc29sZS5sb2coYExvYWRpbmcgcGx1Z2luIERlZmluaXRpb24gTGlzdCB2JHt0aGlzLm1hbmlmZXN0LnZlcnNpb259YCk7XHJcblx0XHR0aGlzLnJlZ2lzdGVyTWFya2Rvd25Qb3N0UHJvY2Vzc29yKHRoaXMuZm9ybWF0RGVmaW5pdGlvbkxpc3RzLCA5OSk7XHJcblx0XHR0aGlzLmFkZFNldHRpbmdUYWIobmV3IERlZmluaXRpb25MaXN0U2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xyXG5cdFx0dGhpcy5yZWdpc3RlckVkaXRvckV4dGVuc2lvbihsaXZlVXBkYXRlRGVmaW5pdGlvbkxpc3RzKTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgZm9ybWF0RGVmaW5pdGlvbkxpc3RzOiBNYXJrZG93blBvc3RQcm9jZXNzb3IgPSBmdW5jdGlvbihlbGVtZW50LCBjb250ZXh0KSB7XHJcblx0XHQvKiBUaGUgcG9zdC1wcm9jZXNzb3IgaXMgY2FsbGVkXHJcblx0XHQgKiAgLSB3aGVuIHN3aXRjaGluZyB0byBSZWFkaW5nIHZpZXc6IG9uY2UgcGVyIGRpdiB0aGF0IGhhcyBjaGFuZ2VkXHJcblx0XHQgKiAgLSB3aGVuIGV4cG9ydGluZyB0byBQREY6IG9uIHRoZSB3aG9sZSBwYWdlIGRpdlxyXG5cdFx0ICogIC0gd2hlbiB0aGUgZG9jdW1lbnQgZmlyc3QgZW50ZXJzIFJlYWRpbmcgdmlldzogb24gZXZlcnkgY2hpbGQtZGl2IG9mIHBhZ2UgZGl2XHJcblx0XHQgKi8gXHJcblx0XHRcclxuXHRcdC8qIEluIGRpcmVjdCBkZXNjZW5kYW50cyBvZiB0eXBlIHBhcmFncmFwaCwgbG9vayBmb3IgZGVmaW5pdGlvbiBsaXN0cy5cclxuXHRcdCAqIFJldHVybiBhcyBzb29uIGFzIHBvc3NpYmxlLiAgKi9cclxuXHRcdGNvbnN0IHBhcmFncmFwaHMgPSBlbGVtZW50LmZpbmRBbGwoJzpzY29wZSA+IHAsIDpzY29wZSA+IGRpdiA+IHAnKTtcclxuXHRcdGxldCBub3RoaW5nVG9EbyA9IHRydWU7XHJcblx0XHRmb3IgKGxldCBwYXIgb2YgcGFyYWdyYXBocylcclxuXHRcdFx0aWYgKHBhci5pbm5lckhUTUwuaW5jbHVkZXMoJzxicj5cXG46ICAgJykpIHtcclxuXHRcdFx0XHRub3RoaW5nVG9EbyA9IGZhbHNlO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHR9XHJcblx0XHRpZiAobm90aGluZ1RvRG8pIHJldHVybjtcclxuXHRcdFxyXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXN1bHRDYWxsYmFjazogKHY6IGFueSkgPT4gdm9pZCwgZXJyb3JDYWxsYmFjaykgPT4ge1x0XHRcclxuXHRcdC8vIFRPRE86IHNvbWUgZXJyb3IgY2hlY2tpbmdcclxuXHRcdFx0cGFyYWdyYXBocy5mb3JFYWNoKHBhciA9PiB7XHJcblx0XHRcdFx0aWYgKCFwYXIuaW5uZXJIVE1MLmluY2x1ZGVzKCc8YnI+XFxuOiAgICcpKSByZXR1cm47XHJcblx0XHRcdFxyXG5cdFx0XHRcdC8vIGNyZWF0ZSB0aGUgPGRsPiBlbGVtZW50IHRoYXQgaXMgdG8gcmVwbGFjZSB0aGUgcGFyYWdyYXBoIGVsZW1lbnRcclxuXHRcdFx0XHRjb25zdCBkZWZMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGwnKTtcclxuXHRcdFx0XHRsZXQgc3RhcnRPZkxpbmU6IGJvb2xlYW4gPSB0cnVlO1xyXG5cdFx0XHRcdGxldCBpdGVtRWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0Ly8gZmlsbCB0aGUgbmV3IDxkbD4gd2l0aCBjbG9uZXMgb2YgdGhlIG5vZGVzIGluIHRoZSBvcmlnaW5hbCA8cD5cclxuXHRcdFx0XHRwYXIuY2hpbGROb2Rlcy5mb3JFYWNoKG5vZGUgPT4ge1xyXG5cdFx0XHRcdFx0aWYgKCd0YWdOYW1lJyBpbiBub2RlICYmIG5vZGUudGFnTmFtZSA9PT0gXCJCUlwiKSB7XHJcblx0XHRcdFx0XHRcdHN0YXJ0T2ZMaW5lID0gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0Y29uc3QgY2xvbmUgPSBub2RlLmNsb25lTm9kZSh0cnVlKTtcclxuXHRcdFx0XHRcdGlmIChzdGFydE9mTGluZSkge1xyXG5cdFx0XHRcdFx0XHRjb25zdCBtYXRjaERlZiA9IG5vZGUudGV4dENvbnRlbnQubWF0Y2goRGVmaW5pdGlvbkxpc3RQbHVnaW4uZGVmaW5pdGlvbk1hcmtlcik7XHJcblx0XHRcdFx0XHRcdGlmIChtYXRjaERlZikge1xyXG5cdFx0XHRcdFx0XHRcdGl0ZW1FbGVtZW50ID0gZGVmTGlzdC5jcmVhdGVFbCgnZGQnKTtcclxuXHRcdFx0XHRcdFx0XHRjbG9uZS50ZXh0Q29udGVudCA9IG5vZGUudGV4dENvbnRlbnQuc2xpY2UobWF0Y2hEZWZbMF0ubGVuZ3RoKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRpdGVtRWxlbWVudCA9IGRlZkxpc3QuY3JlYXRlRWwoJ2R0Jyk7XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdHN0YXJ0T2ZMaW5lID0gZmFsc2U7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpdGVtRWxlbWVudC5hcHBlbmQoY2xvbmUpO1xyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0XHJcblx0XHRcdFx0Ly8gcHV0IHRoZSA8ZGw+IGluIHBsYWNlIG9mIHRoZSA8cD5cclxuXHRcdFx0XHRwYXIucmVwbGFjZVdpdGgoZGVmTGlzdCk7XHJcblx0XHRcdH0pXHJcblx0XHRcdHJlc3VsdENhbGxiYWNrKG51bGwpO1xyXG5cdFx0fSlcclxuXHR9XHJcblx0XHJcblx0b251bmxvYWQoKSB7XHJcblx0XHRjb25zb2xlLmxvZygnVW5sb2FkaW5nIHBsdWdpbiBEZWZpbml0aW9uIExpc3QnKTtcclxuXHR9XHJcbn1cclxuXHJcbi8qIFRoZSBWaWV3UGx1Z2luIGNsYXNzIGlzIGdlbmVyaWM6IGl0IHJlcXVpcmVzIGFuIHVuZGVybHlpbmcgdHlwZSwgYSBzdWJjbGFzcyBvZlxyXG4qIHRoZSBQbHVnaW5WYWx1ZSBjbGFzcy4gVGhhdCBpcyB0byBiZSB0aGUgZmlyc3QgYXJndW1lbnQgcGFzc2VkIGludG8gdGhlIGNsYXNzIG1ldGhvZFxyXG4qIC5mcm9tQ2xhc3MoKSB3aGljaCByZXR1cm5zIGEgVmlld1BsdWdpbiBpbnN0YW5jZSB3aXRoIHRoYXQgdW5kZXJseWluZyB0eXBlLlxyXG4qIFRoZSBzZWNvbmQgYXJndW1lbnQgb2YgdGhhdCBjbGFzcyBtZXRob2QsIHRvIGdpdmUgYWRkaXRpb25hbCBkZXRhaWxzLCBpcyBhIFBsdWdpblNwZWNcclxuKiBpbnN0YW5jZSB3aXRoIHRoZSBzYW1lIHVuZGVybHlpbmcgdHlwZS4gSXQgaGFzIHplcm8gb3IgbW9yZSBvZiB0aGUgcHJvcGVydGllcyBldmVudEhhbmRsZXJzLFxyXG4qIGV2ZW50T2JzZXJ2ZXJzLCBwcm92aWRlLCBhbmQgZGVjb3JhdGlvbnMuIFRoZSBsYXR0ZXIgaXMgYSBmdW5jdGlvbiB0aGF0LCB3aGVuIHBhc3NlZCBhblxyXG4qIGluc3RhbmNlIG9mIHRoZSB1bmRlcmx5aW5nIGNsYXNzLCByZXR1cm5zIGEgRGVjb3JhdGlvblNldCAtIGluIHRoaXMgY2FzZSB0aGUgZnVuY3Rpb25cclxuKiBzaW1wbHkgcmV0dXJucyB0aGUgLmRlY29yYXRpb25zIGluc3RhbmNlIHByb3BlcnR5LiAqL1xyXG5jb25zdCBsaXZlVXBkYXRlRGVmaW5pdGlvbkxpc3RzID0gVmlld1BsdWdpbi5mcm9tQ2xhc3MoXHJcblx0Y2xhc3MgeyAgLy8gdGhlIHBsdWdpbiBpcyBiYXNlZCBvbiBhbiBhbm9ueW1vdXMgY2xhc3Mgd2UgZGVmaW5lIGhlcmVcclxuXHRcdGRlY29yYXRpb25zOiBEZWNvcmF0aW9uU2V0O1xyXG5cdFx0cHJpdmF0ZSByZWFkb25seSBURVJNX0NMQVNTOiBzdHJpbmcgPSAndmlldy1kdCc7XHJcblx0XHRwcml2YXRlIHJlYWRvbmx5IERFRl9DTEFTUzogc3RyaW5nID0gJ3ZpZXctZGQnO1xyXG5cdFx0Y29uc3RydWN0b3IodmlldzogRWRpdG9yVmlldykge1xyXG5cdFx0XHR0aGlzLmRlY29yYXRpb25zID0gRGVjb3JhdGlvbi5ub25lO1xyXG5cdFx0fVxyXG5cdFx0LyogdGhpcy5kZWNvcmF0aW9ucyBzaG91bGQgYmUgYSBjdW11bGF0aXZlIGFycmF5IG9mIGFsbCB0aGUgZGVjb3JhdGlvbnMgKGkuZS5cclxuXHRcdCogY2xhc3MgY2hhbmdlcykgd2UgaGF2ZSBjaG9zZW4gdG8gYWRkIHRvIGxpbmUgZWxlbWVudHMuIFNvIHdlIGFsd2F5cyBhZGQgdG8gaXRcclxuXHRcdCogb3IgbW9kaWZ5IGFuIGV4aXN0aW5nIGVudHJ5LCByYXRoZXIgdGhhbiBpbnN0YW50aWF0aW5nIGl0IGFuZXcuXHJcblx0XHQqIE5vdGUgdGhhdCBpdHMgdHlwZSwgRGVjb3JhdGlvblNldCwgaXMgYSBSYW5nZVNldCBvZiBpdGVtcyBvZiB0aGUgdW5kZXJseWluZ1xyXG5cdFx0KiB0eXBlIERlY29yYXRpb24uIFN1Y2ggYSBSYW5nZVNldCBvYmplY3QgaGFzIHByb3BlcnRpZXMgYW5kIG1ldGhvZHNcclxuXHRcdCogLnNpemUgKG51bWJlciBvZiBlbGVtZW50cyk7IC5pdGVyKCkgd2l0aCBvcHRpb25hbCBhcmcgZnJvbSwgYW4gb2Zmc2V0IHRoYXRcclxuXHRcdCogbGllcyBpbiBvciBiZWZvcmUgdGhlIGZpcnN0IHRvIGJlIGl0ZXJhdGVkOyAudXBkYXRlKFJhbmdlU2V0VXBkYXRlKSB0byBhZGRcclxuXHRcdCogb3IgcmVtb3ZlIHRoZW0gKHJldHVybnMgdGhlIG5ldyB2ZXJzaW9uKTsgLmJldHdlZW4oZnJvbSwgdG8sIGZ1bmMpIHJ1biBmdW5jXHJcblx0XHQqIG9uIGV2ZXJ5IERlY29yYXRpb24gYmV0d2VlbiB0aGUgb2Zmc2V0cyBmcm9tIGFuZCB0bzsgLm1hcChDaGFuZ2VEZXNjKS4gKi9cclxuXHJcblx0XHR1cGRhdGUodXBkYXRlOiBWaWV3VXBkYXRlKSB7XHJcblx0XHRcdGlmICh1cGRhdGUuZG9jQ2hhbmdlZCB8fCB1cGRhdGUuc2VsZWN0aW9uU2V0KVxyXG5cdFx0XHQvKiBvdGhlciBib29sZWFuIHByb3BlcnRpZXMgdGhhdCBtYXkgYmUgdXNlZnVsOlxyXG5cdFx0XHQqICAudmlld3BvcnRDaGFuZ2VkOiB2aWV3cG9ydCBvciB2aXNpYmxlIHJhbmdlcyBoYXZlIGNoYW5nZWRcclxuXHRcdFx0KiAgLmdlb21ldHJ5Q2hhbmdlZDogZWRpdG9yIHNpemUgb3IgdGhlIGRvY3VtZW50IGl0c2VsZiBjaGFuZ2VkXHJcblx0XHRcdCogIC5mb2N1c0NoYW5nZWQ6IG1heWJlIHNvbWUgc3dpdGNoIHRvIGFub3RoZXIgZG9jdW1lbnQsIHBhbmVsIGV0Yy47XHJcblx0XHRcdCogIGNoYW5nZSBpbiBWaWV3IGJldHdlZW4gRWRpdGluZyBhbmQgUmVuZGVyaW5nIHZpZXc7IGJ1dFxyXG5cdFx0XHQqICB3aGVuIHRoZSBkb2N1bWVudC9FZGl0aW5nIGlzIGFjdGl2YXRlZCwgLmdlb21ldHJ5Q2hhbmdlZCBpcyBhbHNvIHRydWUuXHJcblx0XHRcdCovXHJcblx0XHRcdHtcclxuXHRcdFx0XHRjb25zdCBzdGF0ZSA9IHVwZGF0ZS52aWV3LnN0YXRlO1xyXG5cdFx0XHRcdGNvbnN0IGN1cnNvclBvcyA9IHN0YXRlLnNlbGVjdGlvbi5tYWluLmhlYWQ7XHJcblxyXG5cdFx0XHRcdC8vIHRoZSBMaW5lIG9iamVjdCB0aGF0IHJlcHJlc2VudHMgdGhlIGN1cnJlbnQgbGluZSBvZiB0aGUgZG9jdW1lbnRcclxuXHRcdFx0XHQvLyBub3RlIHRoYXQgc3RhdGUuZG9jIGlzIGFuIG9iamVjdCBvZiBjbGFzcyBUZXh0XHJcblx0XHRcdFx0Y29uc3QgY3VycmVudExpbmUgPSBzdGF0ZS5kb2MubGluZUF0KGN1cnNvclBvcyk7XHJcblx0XHRcdFx0Ly8gdGhlIHRleHQgb2YgdGhlIGZvbGxvd2luZyBsaW5lXHJcblx0XHRcdFx0Y29uc3QgbmV4dExpbmVUZXh0OiBzdHJpbmcgPSAoc3RhdGUuZG9jLmxpbmVzID09PSBjdXJyZW50TGluZS5udW1iZXIpID8gJycgOlxyXG5cdFx0XHRcdFx0c3RhdGUuZG9jLmxpbmUoY3VycmVudExpbmUubnVtYmVyICsgMSkudGV4dDtcclxuXHRcdFx0XHRpZiAoIWN1cnJlbnRMaW5lLnRleHQuc3RhcnRzV2l0aCgnOiAgICcpICYmICFuZXh0TGluZVRleHQuc3RhcnRzV2l0aCgnOiAgICcpKVxyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdFx0XHQvLyBUT0RPOiB0d28gdGVybXMgYmVmb3JlIG9uZSBkZWZpbml0aW9uXHJcblx0XHRcdFx0Ly8gVE9ETzogcHV0IDogYW5kIGZpcnN0IHNwYWNlcyBpbiBhIHNlcGFyYXRlIGRpdiBvciBzb1xyXG5cdFx0XHRcdC8vICBhbmQgdGhlbiBpbiBDU1Mgc2F5IGRpdjpub3QoLmNtLWFjdGl2ZSk+LmxlYWRpbmctY2hhcnMge2Rpc3BsYXk6IG5vbmU7fVxyXG5cdFx0XHRcdC8vIFRPRE86IHBhcnNlIGFsbCBkZWZpbml0aW9uIGxpc3RzIHdoZW4gZmlyc3Qgb3BlbmluZyBFZGl0IFZpZXcsIG9yIGF0XHJcblx0XHRcdFx0Ly8gIGxlYXN0IHRob3NlIGluc2lkZSB0aGUgdmlld3BvcnRcclxuXHRcdFx0XHQvLyBUT0RPOiBpbXBsZW1lbnQgcmVtb3ZhbCBvZiBjbGFzcyB3aGVuIGl0J3Mgbm90IGEgREwgYW55bW9yZSBhZnRlciBhbiBlZGl0XHJcblxyXG5cdFx0XHRcdC8vIFBlcmZvcm0gYSBmZXcgY2hlY2tzIGJlZm9yZSBhZGRpbmcgYW55IGNsYXNzZXNcclxuXHRcdFx0XHRjb25zdCBsaW5lQ2xhc3NlcyA9ICB1cGRhdGUudmlldy5kb21BdFBvcyhjdXJzb3JQb3MpXHQubm9kZS5wYXJlbnRFbGVtZW50LmNsb3Nlc3QoJy5jbS1saW5lJyk/LmNsYXNzTGlzdCB8fFxyXG5cdFx0XHRcdFx0e2NvbnRhaW5zOiAoczogc3RyaW5nKSA9PiBmYWxzZX07XHJcblx0XHRcdFx0Ly8gTm8gZGVmaW5pdGlvbiBsaXN0cyBpbnNpZGUgYSBjb2RlIGJsb2NrXHJcblx0XHRcdFx0aWYgKGxpbmVDbGFzc2VzLmNvbnRhaW5zKCdIeXBlck1ELWNvZGVibG9jaycpKVxyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdC8vIERvbid0IGFkZCBhIGNsYXNzIHdoZW4gaXQncyBhbHJlYWR5IGJlZW4gZG9uZVxyXG5cdFx0XHRcdGlmIChsaW5lQ2xhc3Nlcy5jb250YWlucyh0aGlzLkRFRl9DTEFTUykgfHxcclxuXHRcdFx0XHRcdGxpbmVDbGFzc2VzLmNvbnRhaW5zKHRoaXMuVEVSTV9DTEFTUykpXHJcblx0XHRcdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0XHRcdC8vIEZpbmFsbHksIGFzIGFsbCBjcml0ZXJpYSBoYXZlIGJlZW4gbWV0LCB3ZSBnZXQgdG8gd29ya1xyXG5cdFx0XHRcdGNvbnN0IGxpbmVjbGFzczogc3RyaW5nID1cclxuXHRcdFx0XHRcdChjdXJyZW50TGluZS50ZXh0LnN0YXJ0c1dpdGgoJzogICAnKSkgPyB0aGlzLkRFRl9DTEFTUyA6IHRoaXMuVEVSTV9DTEFTUztcclxuXHRcdFx0XHR0aGlzLmRlY29yYXRpb25zID0gdGhpcy5kZWNvcmF0aW9ucy51cGRhdGUoe2FkZDogW0RlY29yYXRpb25cclxuXHRcdFx0XHRcdFx0LmxpbmUoe2NsYXNzOiBsaW5lY2xhc3N9KVxyXG5cdFx0XHRcdFx0XHQucmFuZ2UoY3VycmVudExpbmUuZnJvbSldfSk7ICAvLyBsaW5lIGRlY29yYXRpb25zIGFyZSAwLWxlbmd0aFxyXG5cdFx0XHRcdC8qIHRoZSBhcmd1bWVudCBmb3IgLnVwZGF0ZSBpcyBvZiBjbGFzcyBSYW5nZVNldFVwZGF0ZTxEZWNvcmF0aW9uPixcclxuXHRcdFx0XHQqIGFuZCBSYW5nZVNldFVwZGF0ZSBpcyBhIHR5cGVkZWYgb2YgYW4gT2JqZWN0IHdpdGggb3B0aW9uYWxcclxuXHRcdFx0XHQqIHByb3BlcnR5IC5hZGQgb2YgY2xhc3MgcmVhZG9ubHkgUmFuZ2U8RGVjb3JhdGlvbj47IHRoYXQgaW4gdHVybiBoYXNcclxuXHRcdFx0XHQqIGluc3RhbmNlIHByb3BlcnRpZXMgZnJvbSwgdG8sIGFuZCB0aGUgRGVjb3JhdGlvbi5cclxuXHRcdFx0XHQqIFlvdSBjYW4gY3JlYXRlIGEgUmFuZ2U8RGVjb3JhdGlvbj4gYnkgY3JlYXRpbmcgYSBEZWNvcmF0aW9uIGFuZFxyXG5cdFx0XHRcdCogYXBwbHlpbmcgaXRzIC5yYW5nZSBtZXRob2QgKGluaGVyaXRlZCBmcm9tIGl0cyBzdXBlcmNsYXNzIFJhbmdlVmFsdWUpLlxyXG5cdFx0XHRcdCogTm90ZSB0aGF0IC51cGRhdGUgZG9lc24ndCBtb2RpZnkgdGhlIGluc3RhbmNlIGJ1dCByZXR1cm5zIGl0LiAqL1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vIGlmICh1cGRhdGUudmlld3BvcnRDaGFuZ2VkKSBjb25zb2xlLmxvZygndmlld3BvcnQgY2hhbmdlZCcpO1xyXG5cdFx0XHQvLyBpZiAodXBkYXRlLmdlb21ldHJ5Q2hhbmdlZCkgY29uc29sZS5sb2coJ2dlb21ldHJ5IGNoYW5nZWQnKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cdHtcclxuXHRcdGRlY29yYXRpb25zOiB2ID0+IHYuZGVjb3JhdGlvbnMsXHJcblx0fVxyXG4pO1xyXG5cclxuY2xhc3MgRGVmaW5pdGlvbkxpc3RTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XHJcblx0ZGlzcGxheSgpOiB2b2lkIHtcclxuXHRcdGxldCB7Y29udGFpbmVyRWx9ID0gdGhpcztcclxuXHJcblx0XHRjb250YWluZXJFbC5lbXB0eSgpO1xyXG5cclxuXHRcdGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMicsIHt0ZXh0OiAnU2V0dGluZ3MgZm9yIG15IGF3ZXNvbWUgcGx1Z2luLid9KTtcclxuXHJcblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuXHRcdFx0LnNldE5hbWUoJ1NldHRpbmcgIzEnKVxyXG5cdFx0XHQuc2V0RGVzYygnSXRcXCdzIGEgc2VjcmV0JylcclxuXHRcdFx0LmFkZFRleHQodGV4dCA9PiB0ZXh0LnNldFBsYWNlaG9sZGVyKCdFbnRlciB5b3VyIHNlY3JldCcpXHJcblx0XHRcdFx0LnNldFZhbHVlKCcnKVxyXG5cdFx0XHRcdC5vbkNoYW5nZSgodmFsdWUpID0+IHtcclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKCdTZWNyZXQ6ICcgKyB2YWx1ZSk7XHJcblx0XHRcdFx0fSkpO1xyXG5cclxuXHR9XHJcbn1cclxuIl0sIm5hbWVzIjpbIlBsdWdpbiIsIlZpZXdQbHVnaW4iLCJ2aWV3IiwiRGVjb3JhdGlvbiIsIlNldHRpbmciLCJQbHVnaW5TZXR0aW5nVGFiIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxhQUFhLEdBQUcsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFO0FBQ25DLElBQUksYUFBYSxHQUFHLE1BQU0sQ0FBQyxjQUFjO0FBQ3pDLFNBQVMsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLFlBQVksS0FBSyxJQUFJLFVBQVUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQUNwRixRQUFRLFVBQVUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQUMxRyxJQUFJLE9BQU8sYUFBYSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUMvQixDQUFDLENB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
